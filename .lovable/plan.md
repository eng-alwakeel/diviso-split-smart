
# ุงููุฑุงุญู 3-6: ุฅููุงู ูุธุงู ุงููุฑุฏ ุงูุฐูู V2

---

## ุงููุฑุญูุฉ 3: ุฑุจุท ุงููุชุงุฆุฌ ุจุฅุฌุฑุงุกุงุช ูุจุงุดุฑุฉ

### 3A. ููู ุฌุฏูุฏ: `src/data/diceActions.ts`
ุฌุฏูู ุฑุจุท ูู ูุชูุฌุฉ ูุฑุฏ ุจุฅุฌุฑุงุก ุชูููุฐู:

| ููุน ุงููุฑุฏ | ุงููุชูุฌุฉ | ุงูุฅุฌุฑุงุก | ุงูุชูุฌูู |
|-----------|---------|---------|---------|
| activity | restaurant | ูุชุญ ุฅุถุงูุฉ ูุตุฑูู + ุงูุชุฑุงุญ ูุฑุฏ ุงููุทุงุจุฎ | `/add-expense?groupId=X&category=restaurant` |
| activity | cafe | ูุชุญ ุฅุถุงูุฉ ูุตุฑูู ุจุชุตููู ูุงููู | `/add-expense?groupId=X&category=cafe` |
| activity | entertainment | ูุชุญ ุฅุถุงูุฉ ูุตุฑูู ุจุชุตููู ุชุฑููู | `/add-expense?groupId=X&category=entertainment` |
| cuisine | * (ุฃู ูุทุจุฎ) | ูุง ุฅุฌุฑุงุก ุฎุงุต -- ุงููุทุงุจุฎ ูุนูููุฉ ุณูุงููุฉ | -- |
| budget | ุฃู ูุชูุฌุฉ | ุนุฑุถ ุฒุฑ "ุชุซุจูุช ููุฒุงููุฉ ุงูููู" | ุญูุธ ูู metadata ุงููุฌููุนุฉ |
| whopays | ุนุถู ุนุดูุงุฆู | ุนุฑุถ ุฒุฑ "ุฅูุดุงุก ูุงุชูุฑุฉ ุจุงุณูู" | `/add-expense?groupId=X&paidBy=MEMBER_ID` |
| task | add_expense | ุชูุฌูู ูุฅุถุงูุฉ ูุตุฑูู | `/add-expense` |
| task | settle | ุชูุฌูู ูุตูุญุฉ ุงูุชุณููุฉ | `/groups/X/settle` |
| task | remind | ูุชุญ ุงูุชุฐููุฑ | ูุนุชูุฏ ุนูู ุงูููุทู ุงูููุฌูุฏ |
| task | review_report | ูุชุญ ุงูุชูุฑูุฑ | `/groups/X/report` |
| task | rename_group | ูุชุญ ุฅุนุฏุงุฏุงุช ุงููุฌููุนุฉ | `/group/X/settings` |
| task | invite_member | ูุชุญ ุงูุฏุนูุฉ | `/group/X/settings` |

ุงูููู ูุตุฏูุฑ ุฏุงูุฉ `getActionForResult(diceTypeId, faceId, groupId?, memberId?)` ุชูุฑุฌุน ูุงุฆู ูุญุชูู:
- `label_ar` / `label_en`: ูุต ุงูุฒุฑ
- `icon`: ุฃููููุฉ lucide
- `navigateTo?`: ูุณุงุฑ ุงูุชูุฌูู (ุฅู ูุฌุฏ)
- `handler?`: ุฏุงูุฉ ุชูููุฐ ูุจุงุดุฑ (ุฅู ูู ููู ุชูุฌูู)

### 3B. ุชุญุฏูุซ `DiceResult.tsx`
- ุฅุถุงูุฉ prop ุฌุฏูุฏ `onAction?: (action) => void`
- ุจุนุฏ ุนุฑุถ ุงููุชูุฌุฉุ ุนุฑุถ ุฒุฑ ุฅุฌุฑุงุก ุฏููุงูููู (ุจุฌุงูุจ ุฃุฒุฑุงุฑ "ุงุนุชูุงุฏ" ู"ุฅุนุงุฏุฉ")
- ุงูุฒุฑ ูุณุชุฎุฏู `getActionForResult` ูุชุญุฏูุฏ ุงููุต ูุงูุฃููููุฉ
- ุนูุฏ ุงูุถุบุท ูุชู ุงูุชูุฌูู ุฃู ุงูุชูููุฐ

### 3C. ุชุญุฏูุซ `DiceDecision.tsx` (ุงูู Dialog)
- ุชูุฑูุฑ `onAction` ูู ุงูู dialog ุฅูู `DiceResultDisplay`
- ุนูุฏ ุงูุชูููุฐ: ุฅุบูุงู ุงูู dialog + ุงูุชูุฌูู ุจุงุณุชุฎุฏุงู `useNavigate`

### 3D. ุชุญุฏูุซ `DiceDecisionPage.tsx`
- ููุณ ุงูููุทู: ุฑุจุท ุฒุฑ ุงูุฅุฌุฑุงุก ุจุงูุชูุฌูู

### 3E. ูุฑุฏ "ููู ูุฏูุน" -- ููุทู ุฎุงุต ูู `useDiceDecision.ts`
- ุฅุถุงูุฉ ุฏุงูุฉ `rollWhoPays(members: {id, name}[])`
- ุชุฎุชุงุฑ ุนุถู ุนุดูุงุฆู ูู ูุงุฆูุฉ ุงูุฃุนุถุงุก
- ุชูุฑุฌุน `DiceResult` ุจูุฌู ุฏููุงูููู (ุงุณู ูุตูุฑุฉ ุงูุนุถู)
- ุงูุฅุฌุฑุงุก: ุฒุฑ "ุฅูุดุงุก ูุงุชูุฑุฉ ุจุงุณูู" ููุฌู ูู `/add-expense?groupId=X&paidBy=MEMBER_ID`

### 3F. ุชุญุฏูุซ `DiceDecisionMessage.tsx` (ูู ุงูุดุงุช)
- ุฅุถุงูุฉ badges ููุฃููุงุน ุงูุฌุฏูุฏุฉ (cuisine, budget, whopays, task)
- ุชุญุฏูุซ `renderResultTile` ูุนุฑุถ ุฃููููุงุช ููุตูุต ููุงุณุจุฉ ููู ููุน
- ุฅุถุงูุฉ ุฒุฑ ุฅุฌุฑุงุก ุฏููุงูููู ูู ุญุงูุฉ ุงููุจูู (ุจุฏูุงู ูู "ุงุจุฏุฃ ุงูุชูุณูู" ููุท)

---

## ุงููุฑุญูุฉ 4: ูุถุน ุงููุฑุงุฑ ุงูุณุฑูุน ุงููุญุฏูุซ

### 4A. ุชุญุฏูุซ `useDiceDecision.ts`
- ุชุญุฏูุซ `rollQuickDice` ููุฏุนู ุชุฑููุจุงุช ูุฎุชููุฉ:
  - ุทูุนุฉ + ูุทุงุจุฎ (ุงูุงูุชุฑุงุถู)
  - ูุดุงุท + ููุฒุงููุฉ (ุฎูุงุฑ ุฅุถุงูู)
- ุฅุถุงูุฉ ุญูู `quickMode?: 'activity_cuisine' | 'activity_budget'` ูู state

### 4B. ุชุญุฏูุซ `DualDiceResult` ูู `diceData.ts`
- ุงูู interface ุงูุญุงูู ูุฏุนู ุจุงููุนู `activity` + `cuisine` + `budget`
- ูุง ุชุบููุฑ ูุทููุจ ุนูู ุงูุจููุฉ

### 4C. ุชุญุฏูุซ `DiceDecision.tsx`
- ุนูุฏ ุงุฎุชูุงุฑ "ูุฑุงุฑ ุณุฑูุน" ูู ุงูู pickerุ ุนุฑุถ ุฎูุงุฑ ูุงุฎุชูุงุฑ ุงูุชุฑููุจุฉ

---

## ุงููุฑุญูุฉ 5: ูุธุงู Streak + Gamification

### 5A. ุชุญุฏูุซ `useDiceDecision.ts` -- ุชุณุฌูู ุงูุฑููุฉ
- ุจุนุฏ `consumeCredits('roll_dice')` ุงููุงุฌุญุ ุงุณุชุฏุนุงุก `logAction('dice_roll')`
- ูุชุทูุจ ุชูุฑูุฑ `userId` ูู ุงููููุจูููุช ุงูุฃุจ ุฃู ุงุณุชุฎุฏุงู `supabase.auth.getUser()`

### 5B. ุชุญุฏูุซ `DailyDiceCard.tsx` -- ุนุฑุถ streak
- ุงุณุชุฎุฏุงู `useDailyHub` ุฃู `useRealStreak` ูุฌูุจ ุนุฏุฏ ุฃูุงู ุงูู streak
- ุนุฑุถ ุนุฏุงุฏ ุตุบูุฑ ุจุฌุงูุจ ุนููุงู ุงููุฑุช: "๐ฅ 3 ุฃูุงู"
- ููุท ูุธูุฑ ุฅุฐุง ูุงู ุงูู streak > 0
- ูุณุชุฎุฏู ุงููููุจูููุช ุงูููุฌูุฏ `StreakDisplay`

---

## ุงููุฑุญูุฉ 6: ุชุญุฏูุซ ุงูุชุฑุฌูุฉ + Edge Functions

### 6A. ูููุงุช ุงูุชุฑุฌูุฉ (`ar/dice.json` + `en/dice.json`)
ุฅุถุงูุฉ ููุงุชูุญ ุฌุฏูุฏุฉ:

```text
actions.execute          -- "ุชูููุฐ" / "Execute"
actions.set_budget       -- "ุชุซุจูุช ููุฒุงููุฉ ุงูููู" / "Set Today's Budget"
actions.create_invoice   -- "ุฅูุดุงุก ูุงุชูุฑุฉ" / "Create Invoice"
actions.go_to_task       -- "ุชูููุฐ ุงููููุฉ" / "Do Task"
result.budget_label      -- "ุงูููุฒุงููุฉ" / "Budget"
result.whopays_label     -- "ุงูุฏุงูุน" / "Payer"
result.task_label        -- "ุงููููุฉ" / "Task"
chat.cuisine_badge       -- "ูุทุจุฎ" / "Cuisine"
chat.budget_badge        -- "ููุฒุงููุฉ" / "Budget"
chat.whopays_badge       -- "ููู ูุฏูุน" / "Who Pays"
chat.task_badge          -- "ูููุฉ" / "Task"
chat.cuisine_tile        -- "ุงููุทุจุฎ" / "Cuisine"
chat.budget_tile         -- "ุงูููุฒุงููุฉ" / "Budget"
chat.whopays_tile        -- "ุงูุฏุงูุน" / "Payer"
chat.task_tile           -- "ุงููููุฉ" / "Task"
```

(ุฃุบูุจ ูุฐู ุงูููุงุชูุญ ููุฌูุฏุฉ ูุนูุงู ูู ุงููุฑุญูุฉ ุงูุณุงุจูุฉ -- ุณูุชู ุงูุชุญูู ูุฅุถุงูุฉ ุงููุงูุต ููุท)

### 6B. ุชุญุฏูุซ `generate-dice-comment/index.ts`
- ุชูุณูุน `dice_type` ููุดูู: `'activity' | 'food' | 'cuisine' | 'budget' | 'whopays' | 'task' | 'quick'`
- ุชุญุฏูุซ prompt ุงูู DeepSeek ููุดูู ุงูุณูุงู ุงูุฌุฏูุฏ (ููุน ุงูููุฒุงููุฉุ ููู ูุฏูุนุ ุงููููุฉ)
- ุชูููู timeout ูู 4 ุซูุงูู ุฅูู 2 ุซุงููุฉ
- ุฅุถุงูุฉ fallback comments ููุฃููุงุน ุงูุฌุฏูุฏุฉ

### 6C. ุชุญุฏูุซ `suggest-dice/index.ts`
- ุงูููุทู ุงูุญุงูู ูุฏุนู ุงูุฃููุงุน ุงูุฌุฏูุฏุฉ ุจุงููุนู (ุชู ุชุญุฏูุซู ูู ุงููุฑุญูุฉ ุงูุณุงุจูุฉ)
- ูุฑุงุฌุนุฉ ุณุฑูุนุฉ ููุชุฃูุฏ ูู ุฃู fallback ูุบุทู ูู ุงูุญุงูุงุช

---

## ููุฎุต ุงููููุงุช ุงููุชุฃุซุฑุฉ

| ุงูููู | ุงูุชุบููุฑ |
|-------|---------|
| `src/data/diceActions.ts` | **ุฌุฏูุฏ** -- ุฑุจุท ุงููุชุงุฆุฌ ุจุงูุฅุฌุฑุงุกุงุช |
| `src/components/dice/DiceResult.tsx` | ุฒุฑ ุฅุฌุฑุงุก ุฏููุงูููู |
| `src/components/dice/DiceDecision.tsx` | ุชูุฑูุฑ onAction + quick mode |
| `src/pages/DiceDecisionPage.tsx` | ุฑุจุท ุงูุฅุฌุฑุงุกุงุช |
| `src/hooks/useDiceDecision.ts` | rollWhoPays + streak logging + quick modes |
| `src/components/daily-hub/DailyDiceCard.tsx` | ุนุฑุถ streak |
| `src/components/chat/messages/DiceDecisionMessage.tsx` | badges + ุฅุฌุฑุงุกุงุช ุงูุฃููุงุน ุงูุฌุฏูุฏุฉ |
| `src/i18n/locales/ar/dice.json` | ููุงุชูุญ ุงูุฅุฌุฑุงุกุงุช ุงูุฌุฏูุฏุฉ |
| `src/i18n/locales/en/dice.json` | ููุงุชูุญ ุงูุฅุฌุฑุงุกุงุช ุงูุฌุฏูุฏุฉ |
| `supabase/functions/generate-dice-comment/index.ts` | ุฃููุงุน ุฌุฏูุฏุฉ + timeout 2s |
| `src/services/diceChatService.ts` | ุฏุนู ุงูุฃููุงุน ุงูุฌุฏูุฏุฉ ูู reroll |

---

## ุชุฑุชูุจ ุงูุชูููุฐ

1. ุงููุฑุญูุฉ 6A (ุชุฑุฌูุฉ) -- ุชูููุฐ ุฃููุงู ูุฃู ุจุงูู ุงููุฑุงุญู ุชุนุชูุฏ ุนูู ุงูููุงุชูุญ
2. ุงููุฑุญูุฉ 3 (ุฅุฌุฑุงุกุงุช + diceActions.ts + ุชุญุฏูุซ UI)
3. ุงููุฑุญูุฉ 4 (ุงููุฑุงุฑ ุงูุณุฑูุน)
4. ุงููุฑุญูุฉ 5 (Streak)
5. ุงููุฑุญูุฉ 6B+6C (Edge Functions)
